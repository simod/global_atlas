{% load staticfiles %}
{% load bootstrap_tags %}
<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Global Atlas</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css styles/vendor.css -->
    <link rel="stylesheet" href="{% static "bower_components/select2/select2.css" %}">
    <link rel="stylesheet" href="{% static "bower_components/jquery-ui/themes/smoothness/jquery-ui.css" %}">
    <!-- bower:css -->
    <link rel="stylesheet" href="{% static "bower_components/bootstrap/dist/css/bootstrap.css" %}">
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css({.tmp,app}) styles/main.css -->
    <link rel="stylesheet" href="{% static "styles/main.css" %}">
    <!-- endbuild -->
  </head>
  <body ng-controller="AtlasController">
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <header>
      <h1 class="col-md-offset-4">Global Atlas</h1>
    </header>
    <nav>
      <button class="btn-lg btn-primary pull-right" data-toggle="modal" data-target="#mr_form">Request a map</button>
    </nav>
    
    <!-- Add search here -->
    <div class="search pull-left" id="search">
      <p>Countries</p>
      <div id="country_select" ui-select2="select2Options" ng-model="select2" placeholder="Type to search" ng-controller="CountrySelectController">
      </div>
      <p>Regions</p>
      <ul id="regions">
        {% for region in regions %}
          <li>{{ region }}</li>
        {% endfor %}
      </ul>
      <p>Categories</p>
      <ul id="categories">
        {% for category in categories %}
          <li>{{ category }}</li>
        {% endfor %}
      </ul>
      <p>Themes</p>
      <ul id="themes">
        {% for theme in themes %}
          <li>{{ theme }}</li>
        {% endfor %}
      </ul>
    </div>

    <!-- Add map here -->
    <div class="map" id="map">
      Map goes here
    </div>

    <div class="search_results pull-right" id="search_results">
      <h2>Maps</h2>
      <div ng-repeat="map in search_results">
        <span ng-bind="map.title"></span>
      </div>
    </div>

    <!-- Map Request form -->
    <div class="modal fade" id="mr_form">
        <div class="modal-content">
            <form name="{{mr_form.name}}" ng-controller="MRController" novalidate>
                <legend>Request for a map</legend>
                {{ mr_form.as_p }}
                <div class="form-actions">
                  <a class="btn" data-dismiss="modal">Close</a>
                  <button type="submit" ng-disabled="!mr_form.$valid" class="btn btn-primary" ng-click="submit()">Save changes</button>
                </div>           
            </form>
        </div>
    </div>

    <!--[if lt IE 9]>
    <script src="bower_components/es5-shim/es5-shim.js"></script>
    <script src="bower_components/json3/lib/json3.min.js"></script>
    <![endif]-->

    <!-- build:js scripts/vendor.js -->
    <!-- bower:js -->
    <script src="{% static "bower_components/jquery/jquery.js" %}"></script>
    <script src="{% static "bower_components/select2/select2.min.js" %}"></script>
    <script src="{% static "bower_components/angular/angular.js" %}"></script>
    <script src="{% static "bower_components/bootstrap/dist/js/bootstrap.js" %}"></script>
    <script src="{% static "bower_components/angular-cookies/angular-cookies.js" %}"></script>
    <script src="{% static "bower_components/angular-sanitize/angular-sanitize.js" %}"></script>
    <script src="{% static "bower_components/angular-route/angular-route.js" %}"></script>
    <script src="{% static "bower_components/jquery-ui/ui/jquery-ui.js" %}"></script>
    <script src="{% static "bower_components/angular-ui-select2/src/select2.js" %}"></script>
    <!-- endbower -->
    <!-- endbuild -->

    <script>
      window.CLOSURE_NO_DEPS = true;
      window.CLOSURE_BASE_PATH = "."
    </script>

    <script src="{% static "bower_components/closure-library/closure/goog/base.js" %}"></script>

    <script src="{% static "deps.js" %}"></script>
    <script>
        goog.require('atlas');
     </script>
      <script type="text/javascript">
        (function(){
          $( "#id_deadline" ).datepicker();
          $.get("{% url 'api_api_top_level' api_name='api' %}", function(data){
            var module = angular.module('atlas');

            // Set the initial api url
            module.constant('ApiUrls', {
              urls: data
            });

            // Configure general ajax parameters
            module.config(function($httpProvider) {
              $httpProvider.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
              $httpProvider.defaults.xsrfCookieName = 'csrftoken';
              $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
            });

            angular.bootstrap(document,['atlas']);
          });
        })();
      </script>
</body>
</html>
