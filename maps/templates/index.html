{% load staticfiles %}
{% load bootstrap_tags %}
<!doctype html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Global Atlas</title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width">
    <!-- Place favicon.ico and apple-touch-icon.png in the root directory -->
    <!-- build:css styles/vendor.css -->
    <link rel="stylesheet" href="{% static "bower_components/select2/select2.css" %}">
    <link rel="stylesheet" href="{% static "bower_components/leaflet-dist/leaflet.css" %}">
    <link rel="stylesheet" href="{% static "bower_components/jquery-ui/themes/smoothness/jquery-ui.css" %}">
    <!-- bower:css -->
    <link rel="stylesheet" href="{% static "bower_components/bootstrap/dist/css/bootstrap.css" %}">
    <link rel="stylesheet" href="{% static "styles/flags.css" %}">
    <!-- endbower -->
    <!-- endbuild -->
    <!-- build:css({.tmp,app}) styles/main.css -->
    <link rel="stylesheet" href="{% static "styles/main.css" %}">
    <!-- endbuild -->
  </head>
  <body ng-controller="AtlasController">
    <!--[if lt IE 7]>
      <p class="browsehappy">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> to improve your experience.</p>
    <![endif]-->

    <div id="wrapper">
      <header class="col-md-12 header">
        <h1 class="col-md-4">Global Atlas</h1>
        <button class="btn-lg btn-primary col-md-3 col-md-offset-4 " data-toggle="modal" data-target="#mr_form">Request a map</button>
      </header>
      
      <!-- Add search here -->
      <div class="search col-md-3 pull-left" id="search">
        <h3>Query Filters</h3>
        <div class="spatial-filters pull-left">
          <strong class="pull-left">Search by country or by region</strong>
          <div>
            <label>Countries</label>
            <div id="country_select" ui-select2="select2Options" ng-model="select2" placeholder="Type to search" ng-controller="CountrySelectController">
            </div>
          </div>
          <div class="pull-left search_block">
            <label>Regions</label>
            <ul class="search_filter" id="regions">
              {% for region in regions %}
                <li data-class="country" value="{{ region.id }}">{{ region }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
        <div class="attribute-filters pull-left">
          <strong class="pull-left">Refine your query</strong>
          <div class="pull-left search_block">
            <label>Themes</label>
            <ul class="search_filter" id="themes">
              {% for theme in themes %}
                <li data-class="theme" value="{{ theme.id }}">{{ theme }}</li>
              {% endfor %}
            </ul>
          </div>
          <div class="pull-right search_block">
            <label>Categories</label>
            <ul class="search_filter" id="categories">
              {% for category in categories %}
                <li data-class="category" value="{{ category.id }}">{{ category }}</li>
              {% endfor %}
            </ul>
          </div>
        </div>
      </div>

      <!-- Add map here -->
      <div ng-controller="MapController" class="map col-md-4 pull-left" id="map">
        <leaflet center="center" geojson="countries" layers="layers" legend="legend">
        </leaflet>
      </div>

      <div class="search_results pull-left" id="search_results">
        <h3>Found 
           <ng-pluralize count="search_total_counts"
            when="{'one': '1 Map', 'other': '{} Maps'}"><ng-pluralize>
        </h3>
        <div class="pager">
          <a><strong ng-click="paginate_down()">-</strong></a>
          <span>page </span>
          <span ng-model="page" ng-bind="page"></span>
          <span> of </span>
          <span ng-bind="numpages"></span>
          <a><strong ng-click="paginate_up()">+</strong></a>
        </div>
        <div ng-repeat="map in search_results">
          <article class="result_article">
            <div class="item-header">
              <h4 ng-bind="map.title"></h4>
            </div>
            <div class="details">
              <ul>      
                <li><strong>Format: </strong><span ng-bind="map.size.name"></span></li>
                <li><strong>Source: </strong><span ng-bind="map.source.name"></span></li>
              </ul>
            </div>
          </article>
        </div>
      </div>
    </div>

    <!-- Map Request form -->
    <div class="modal fade col-md-4 col-md-offset-4" id="mr_form">
        <div class="modal-content mr_form_wrapper">
            <form name="{{mr_form.name}}" ng-controller="MRController" novalidate>
                <legend>Request for a map</legend>
                {{ mr_form.as_p }}
                <div class="form-actions">
                  <a class="btn" data-dismiss="modal">Close</a>
                  <button type="submit" ng-disabled="!mr_form.$valid" class="btn btn-primary" ng-click="submit()">Save changes</button>
                </div>           
            </form>
        </div>
    </div>

    <!--[if lt IE 9]>
    <script src="bower_components/es5-shim/es5-shim.js"></script>
    <script src="bower_components/json3/lib/json3.min.js"></script>
    <![endif]-->

    <!-- build:js scripts/vendor.js -->
    <!-- bower:js -->
    <script src="{% static "bower_components/jquery/jquery.js" %}"></script>
    <script src="{% static "bower_components/select2/select2.min.js" %}"></script>
    <script src="{% static "bower_components/angular/angular.js" %}"></script>
    <script src="{% static "bower_components/bootstrap/dist/js/bootstrap.js" %}"></script>
    <script src="{% static "bower_components/jquery-ui/ui/jquery-ui.js" %}"></script>
    <script src="{% static "bower_components/angular-ui-select2/src/select2.js" %}"></script>
    <script src="{% static "bower_components/leaflet-dist/leaflet.js" %}"></script>
    <script src="{% static "bower_components/angular-leaflet-directive/dist/angular-leaflet-directive.js" %}"></script>
    <!-- endbower -->
    <!-- endbuild -->

    <script>
      window.CLOSURE_NO_DEPS = true;
      window.CLOSURE_BASE_PATH = "."
    </script>

    <script src="{% static "bower_components/closure-library/closure/goog/base.js" %}"></script>

    <script src="{% static "deps.js" %}"></script>
    <script>
        goog.require('atlas');
     </script>
      <script type="text/javascript">
        (function(){
          $( "#id_deadline" ).datepicker();
          $.get("{% url 'api_api_top_level' api_name='api' %}", function(data){
            var module = angular.module('atlas');

            // Set the initial api url
            module.constant('ApiUrls', {
              urls: data
            });

            // Configure general ajax parameters
            module.config(function($httpProvider) {
              $httpProvider.defaults.headers.common['X-Requested-With'] = 'XMLHttpRequest';
              $httpProvider.defaults.xsrfCookieName = 'csrftoken';
              $httpProvider.defaults.xsrfHeaderName = 'X-CSRFToken';
            });

            angular.bootstrap(document,['atlas']);
          });
        })();
      </script>
</body>
</html>
